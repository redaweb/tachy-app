window.cartoSBA={
listeInter:[
 {
   "nom": "-- -- SS-BHO",
   "voie": "V1",
   "x": 165,
   "y": 159
 },
 {
   "nom": "SS-BHO -- SS-DJA",
   "voie": "V1",
   "x": 161,
   "y": 103
 },
 {
   "nom": "SS-DJA -- SS-SIP",
   "voie": "V1",
   "x": 198,
   "y": 86
 },
 {
   "nom": "SS-SIP -- SS-FAB",
   "voie": "V1",
   "x": 220,
   "y": 147
 },
 {
   "nom": "SS-FAB -- SS-SBK",
   "voie": "V1",
   "x": 261,
   "y": 258
 },
 {
   "nom": "SS-SBK -- SS-MAI",
   "voie": "V1",
   "x": 293,
   "y": 317
 },
 {
   "nom": "SS-MAI -- SS-FDJ",
   "voie": "V1",
   "x": 337,
   "y": 292
 },
 {
   "nom": "SS-FDJ -- SS-FUS",
   "voie": "V1",
   "x": 374,
   "y": 280
 },
 {
   "nom": "SS-FUS -- SS-ZID",
   "voie": "V1",
   "x": 425,
   "y": 280
 },
 {
   "nom": "SS-ZID -- SS-BBL",
   "voie": "V1",
   "x": 482,
   "y": 280
 },
 {
   "nom": "SS-BBL -- SS-DJB",
   "voie": "V1",
   "x": 526,
   "y": 278
 },
 {
   "nom": "SS-DJB -- SS-BAL",
   "voie": "V1",
   "x": 577,
   "y": 278
 },
 {
   "nom": "SS-BAL -- SS-BER",
   "voie": "V1",
   "x": 622,
   "y": 280
 },
 {
   "nom": "SS-BER -- SS-MEB",
   "voie": "V1",
   "x": 672,
   "y": 293
 },
 {
   "nom": "SS-MEB -- SS-BLK",
   "voie": "V1",
   "x": 729,
   "y": 310
 },
 {
   "nom": "SS-BLK -- SS-RBT",
   "voie": "V1",
   "x": 783,
   "y": 331
 },
 {
   "nom": "SS-RBT -- SS-DID",
   "voie": "V1",
   "x": 840,
   "y": 300
 },
 {
   "nom": "SS-DID -- SS-LBM",
   "voie": "V1",
   "x": 839,
   "y": 226
 },
 {
   "nom": "SS-LBM -- SS-DJM",
   "voie": "V1",
   "x": 849,
   "y": 186
 },
 {
   "nom": "SS-DJM -- SS-HEB",
   "voie": "V1",
   "x": 883,
   "y": 184
 },
 {
   "nom": "SS-HEB -- SS-BAG",
   "voie": "V1",
   "x": 896,
   "y": 198
 },
 {
   "nom": "SS-BAG -- SS-DEC",
   "voie": "V1",
   "x": 894,
   "y": 235
 },
 {
   "nom": "SS-DEC -- --",
   "voie": "V1",
   "x": 887,
   "y": 316
 },
 {
   "nom": "-- -- SS-BCK",
   "voie": "V1",
   "x": 52,
   "y": 166
 },
 {
   "nom": "SS-BCK -- SS-FTM",
   "voie": "V1",
   "x": 100,
   "y": 115
 },
 {
   "nom": "SS-FTM -- SS-SIP",
   "voie": "V1",
   "x": 133,
   "y": 76
 },
 {
   "nom": "-- -- SS-BAG",
   "voie": "V2",
   "x": 925,
   "y": 267
 },
 {
   "nom": "SS-BAG -- SS-HEB",
   "voie": "V2",
   "x": 925,
   "y": 195
 },
 {
   "nom": "SS-HEB -- SS-DJM",
   "voie": "V2",
   "x": 883,
   "y": 159
 },
 {
   "nom": "SS-DJM -- SS-LBM",
   "voie": "V2",
   "x": 846,
   "y": 162
 },
 {
   "nom": "SS-LBM -- SS-DID",
   "voie": "V2",
   "x": 816,
   "y": 217
 },
 {
   "nom": "SS-DID -- SS-RBT",
   "voie": "V2",
   "x": 816,
   "y": 285
 },
 {
   "nom": "SS-RBT -- SS-BLK",
   "voie": "V2",
   "x": 782,
   "y": 314
 },
 {
   "nom": "SS-BLK -- SS-MEB",
   "voie": "V2",
   "x": 733,
   "y": 295
 },
 {
   "nom": "SS-MEB -- SS-BER",
   "voie": "V2",
   "x": 681,
   "y": 278
 },
 {
   "nom": "SS-BER -- SS-BAL",
   "voie": "V2",
   "x": 634,
   "y": 263
 },
 {
   "nom": "SS-BAL -- SS-DJB",
   "voie": "V2",
   "x": 572,
   "y": 263
 },
 {
   "nom": "SS-DJB -- SS-BBL",
   "voie": "V2",
   "x": 536,
   "y": 263
 },
 {
   "nom": "SS-BBL -- SS-ZID",
   "voie": "V2",
   "x": 488,
   "y": 259
 },
 {
   "nom": "SS-ZID -- SS-FUS",
   "voie": "V2",
   "x": 426,
   "y": 263
 },
 {
   "nom": "SS-FUS -- SS-FDJ",
   "voie": "V2",
   "x": 384,
   "y": 266
 },
 {
   "nom": "SS-FDJ -- SS-MAI",
   "voie": "V2",
   "x": 328,
   "y": 262
 },
 {
   "nom": "SS-MAI -- SS-SBK",
   "voie": "V2",
   "x": 303,
   "y": 307
 },
 {
   "nom": "SS-SBK -- SS-FAB",
   "voie": "V2",
   "x": 275,
   "y": 252
 },
 {
   "nom": "SS-FAB -- SS-SIP",
   "voie": "V2",
   "x": 247,
   "y": 189
 },
 {
   "nom": "SS-SIP -- SS-DJA",
   "voie": "V2",
   "x": 231,
   "y": 87
 },
 {
   "nom": "SS-DJA -- SS-BHO",
   "voie": "V2",
   "x": 142,
   "y": 105
 },
 {
   "nom": "SS-BHO -- SS-OSL",
   "voie": "V2",
   "x": 139,
   "y": 139
 },
 {
   "nom": "SS-OSL -- --",
   "voie": "V2",
   "x": 136,
   "y": 200
 },
 {
   "nom": "SS-SIP -- SS-FTM",
   "voie": "V2",
   "x": 125,
   "y": 61
 },
 {
   "nom": "SS-FTM -- SS-BCK",
   "voie": "V2",
   "x": 92,
   "y": 95
 },
 {
   "nom": "SS-BCK -- SS-BAD",
   "voie": "V2",
   "x": 34,
   "y": 146
 },
 {
   "nom": "SS-BAD -- --",
   "voie": "V2",
   "x": 24,
   "y": 208
 }
],
initCarto: function(canvas, interstationsData) {
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = '/images/lignes/ligne STF.png';

    return new Promise((resolve, reject) => {
        img.onload = () => {
            this.drawCarte(ctx, img, interstationsData);
            resolve();
        };

        img.onerror = () => {
            console.error('Erreur de chargement de l\'image de la ligne STF');
            reject();
        };
    });
},

drawCarte: function(ctx, img, interstationsData) {
    // Dessiner l'image de fond
    ctx.drawImage(img, 0, 0);

    // Dessiner les interstations
    this.listeInter.forEach((inter) => {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            // Taille proportionnelle au nombre d'excès
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

            // Couleur selon la voie
            ctx.fillStyle = inter.voie === "V2" ?
                'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

            ctx.beginPath();
            ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Texte avec le nombre d'excès
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.total.toString(), inter.x, inter.y);

            // Nom de l'interstation
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
        }
    });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
    for (const inter of this.listeInter) {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
            const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

            if (distance <= radius + tolerance) {
                return { inter, data };
            }
        }
    }
    return null;
}
};
