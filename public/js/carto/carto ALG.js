window.cartoALG = {
listeInter:[
  {
    "nom": "-- -- Ruiseau",
    "voie": "V1",
    "x": 0,
    "y": 0
  },
  {
    "nom": "Ruiseau -- Fusilles",
    "voie": "V1",
    "x": 74,
    "y": 281
  },
  {
    "nom": "Fusilles -- Trip thaalibia",
    "voie": "V1",
    "x": 86,
    "y": 280
  },
  {
    "nom": "Trip thaalibia -- Trip Mosquee",
    "voie": "V1",
    "x": 101,
    "y": 282
  },
  {
    "nom": "Trip Mosquee -- Trip Hamadache",
    "voie": "V1",
    "x": 121,
    "y": 297
  },
  {
    "nom": "Trip Hamadache -- El Magharia",
    "voie": "V1",
    "x": 152,
    "y": 313
  },
  {
    "nom": "El Magharia -- caroubier",
    "voie": "V1",
    "x": 185,
    "y": 333
  },
  {
    "nom": "caroubier -- La Glaciere",
    "voie": "V1",
    "x": 212,
    "y": 348
  },
  {
    "nom": "La Glaciere -- Pont EL Harache",
    "voie": "V1",
    "x": 241,
    "y": 363
  },
  {
    "nom": "Pont EL Harache -- Bellevue",
    "voie": "V1",
    "x": 256,
    "y": 379
  },
  {
    "nom": "Bellevue -- Bekri Bouguerra",
    "voie": "V1",
    "x": 280,
    "y": 387
  },
  {
    "nom": "Bekri Bouguerra -- Cinq Maisons",
    "voie": "V1",
    "x": 305,
    "y": 392
  },
  {
    "nom": "Cinq Maisons -- La Foire D'alger",
    "voie": "V1",
    "x": 348,
    "y": 412
  },
  {
    "nom": "La Foire D'alger -- Les Pins",
    "voie": "V1",
    "x": 413,
    "y": 391
  },
  {
    "nom": "Les Pins -- TAMARIS",
    "voie": "V1",
    "x": 444,
    "y": 376
  },
  {
    "nom": "TAMARIS -- Cite zerhouni",
    "voie": "V1",
    "x": 471,
    "y": 370
  },
  {
    "nom": "Cite zerhouni -- Cite Rabia",
    "voie": "V1",
    "x": 470,
    "y": 388
  },
  {
    "nom": "Cite Rabia -- Univ BEZ",
    "voie": "V1",
    "x": 494,
    "y": 433
  },
  {
    "nom": "Univ BEZ -- Cite 5 Juillet",
    "voie": "V1",
    "x": 540,
    "y": 441
  },
  {
    "nom": "Cite 5 Juillet -- BEZ Le PONT",
    "voie": "V1",
    "x": 542,
    "y": 400
  },
  {
    "nom": "BEZ Le PONT -- CITE UNIV CUB1",
    "voie": "V1",
    "x": 538,
    "y": 356
  },
  {
    "nom": "CITE UNIV CUB1 -- CITE 08 MAI 45",
    "voie": "V1",
    "x": 542,
    "y": 325
  },
  {
    "nom": "CITE 08 MAI 45 -- C-MATIN",
    "voie": "V1",
    "x": 550,
    "y": 302
  },
  {
    "nom": "C-MATIN -- BEK lycée",
    "voie": "V1",
    "x": 553,
    "y": 283
  },
  {
    "nom": "BEK lycÃ©e -- BEK centre",
    "voie": "V1",
    "x": 570,
    "y": 272
  },
  {
    "nom": "BEK centre -- BEK polyclinique",
    "voie": "V1",
    "x": 601,
    "y": 262
  },
  {
    "nom": "BEK polyclinique -- MOUHOUS",
    "voie": "V1",
    "x": 629,
    "y": 259
  },
  {
    "nom": "MOUHOUS -- M-HAMOUD",
    "voie": "V1",
    "x": 648,
    "y": 253
  },
  {
    "nom": "M-HAMOUD -- BEN MRABET",
    "voie": "V1",
    "x": 672,
    "y": 247
  },
  {
    "nom": "BEN MRABET -- BEN REDOUANE",
    "voie": "V1",
    "x": 704,
    "y": 229
  },
  {
    "nom": "BEN REDOUANE -- BEN MERAD",
    "voie": "V1",
    "x": 748,
    "y": 197
  },
  {
    "nom": "BEN MERAD -- SIDI DRIS",
    "voie": "V1",
    "x": 791,
    "y": 146
  },
  {
    "nom": "SIDI DRIS -- BENZERGA",
    "voie": "V1",
    "x": 823,
    "y": 95
  },
  {
    "nom": "BENZERGA -- CAFE CHERGUI",
    "voie": "V1",
    "x": 841,
    "y": 70
  },
  {
    "nom": "CAFE CHERGUI -- DERGANA UNIVERSITE",
    "voie": "V1",
    "x": 865,
    "y": 70
  },
  {
    "nom": "DERGANA UNIVERSITE -- DERGANA CITE",
    "voie": "V1",
    "x": 881,
    "y": 64
  },
  {
    "nom": "DERGANA CITE -- DERGANA CENTRE",
    "voie": "V1",
    "x": 882,
    "y": 79
  },
  {
    "nom": "DERGANA CENTRE -- --",
    "voie": "V1",
    "x": 882,
    "y": 107
  },
  {
    "nom": "-- -- DERGANA CENTRE",
    "voie": "V2",
    "x": 0,
    "y": 0
  },
  {
    "nom": "DERGANA CENTRE -- DERGANA CITE",
    "voie": "V2",
    "x": 895,
    "y": 79
  },
  {
    "nom": "DERGANA CITE -- DERGANA universite",
    "voie": "V2",
    "x": 894,
    "y": 58
  },
  {
    "nom": "DERGANA universite -- CAFE CHERGUI",
    "voie": "V2",
    "x": 867,
    "y": 45
  },
  {
    "nom": "CAFE CHERGUI -- BENZERGA",
    "voie": "V2",
    "x": 836,
    "y": 57
  },
  {
    "nom": "BENZERGA -- SIDI DRIS",
    "voie": "V2",
    "x": 817,
    "y": 77
  },
  {
    "nom": "SIDI DRIS -- BEN MERAD",
    "voie": "V2",
    "x": 777,
    "y": 126
  },
  {
    "nom": "BEN MERAD -- BEN REDOUANE",
    "voie": "V2",
    "x": 736,
    "y": 183
  },
  {
    "nom": "BEN REDOUANE -- BEN MRABET",
    "voie": "V2",
    "x": 696,
    "y": 212
  },
  {
    "nom": "BEN MRABET -- M- HAMOUD",
    "voie": "V2",
    "x": 668,
    "y": 234
  },
  {
    "nom": "M- HAMOUD -- MOUHOUS",
    "voie": "V2",
    "x": 648,
    "y": 241
  },
  {
    "nom": "MOUHOUS -- BEK POLYCLINIQUE",
    "voie": "V2",
    "x": 628,
    "y": 245
  },
  {
    "nom": "BEK POLYCLINIQUE -- BEK CENTRE",
    "voie": "V2",
    "x": 593,
    "y": 245
  },
  {
    "nom": "BEK CENTRE -- BEK LYCEE",
    "voie": "V2",
    "x": 560,
    "y": 261
  },
  {
    "nom": "BEK LYCEE -- C-MATIN",
    "voie": "V2",
    "x": 540,
    "y": 277
  },
  {
    "nom": "C-MATIN -- CITE 08 MAI 45",
    "voie": "V2",
    "x": 537,
    "y": 297
  },
  {
    "nom": "CITE 08 MAI 45 -- CITE UNIV CUB1",
    "voie": "V2",
    "x": 533,
    "y": 322
  },
  {
    "nom": "CITE UNIV CUB1 -- BEZ LE PONT",
    "voie": "V2",
    "x": 528,
    "y": 348
  },
  {
    "nom": "BEZ LE PONT -- CITE 05 JUILLET",
    "voie": "V2",
    "x": 520,
    "y": 392
  },
  {
    "nom": "CITE 05 JUILLET -- UNV BEZ",
    "voie": "V2",
    "x": 527,
    "y": 425
  },
  {
    "nom": "UNV BEZ -- CITE RABIA",
    "voie": "V2",
    "x": 504,
    "y": 421
  },
  {
    "nom": "CITE RABIA -- CITE ZERHOUNI",
    "voie": "V2",
    "x": 491,
    "y": 386
  },
  {
    "nom": "CITE ZERHOUNI -- TAMARIS",
    "voie": "V2",
    "x": 467,
    "y": 355
  },
  {
    "nom": "TAMARIS -- LES PINS",
    "voie": "V2",
    "x": 439,
    "y": 362
  },
  {
    "nom": "LES PINS -- LA FOIRE D'ALGER",
    "voie": "V2",
    "x": 409,
    "y": 374
  },
  {
    "nom": "LA FOIRE D'ALGER -- CINQ MAISONS",
    "voie": "V2",
    "x": 354,
    "y": 403
  },
  {
    "nom": "CINQ MAISONS -- BEKRI BOUGUERRA",
    "voie": "V2",
    "x": 307,
    "y": 380
  },
  {
    "nom": "BEKRI BOUGUERRA -- BELLEVUE",
    "voie": "V2",
    "x": 281,
    "y": 377
  },
  {
    "nom": "BELLEVUE -- PONT EL HARRACHE",
    "voie": "V2",
    "x": 263,
    "y": 368
  },
  {
    "nom": "PONT EL HARRACHE -- LA GLACIERE",
    "voie": "V2",
    "x": 246,
    "y": 352
  },
  {
    "nom": "LA GLACIERE -- CROUBIER",
    "voie": "V2",
    "x": 220,
    "y": 336
  },
  {
    "nom": "CROUBIER -- EL MAGHARIA",
    "voie": "V2",
    "x": 196,
    "y": 323
  },
  {
    "nom": "EL MAGHARIA -- TRIP HAMADACHE",
    "voie": "V2",
    "x": 160,
    "y": 305
  },
  {
    "nom": "TRIP HAMADACHE -- TRIP MOQUEE",
    "voie": "V2",
    "x": 128,
    "y": 287
  },
  {
    "nom": "TRIP MOQUEE -- TRIP THAALIBIA",
    "voie": "V2",
    "x": 103,
    "y": 274
  },
  {
    "nom": "TRIP THAALIBIA -- LES FUSILLES",
    "voie": "V2",
    "x": 85,
    "y": 263
  },
  {
    "nom": "LES FUSILLES -- RUISSEAU",
    "voie": "V2",
    "x": 65,
    "y": 272
  },
  {
    "nom": "RUISSEAU -- --",
    "voie": "V2",
    "x": 0,
    "y": 0
  }
],
initCarto: function(canvas, interstationsData) {
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = '/images/lignes/ligne ALG.png';

    return new Promise((resolve, reject) => {
        img.onload = () => {
            this.drawCarte(ctx, img, interstationsData);
            resolve();
        };

        img.onerror = () => {
            console.error('Erreur de chargement de l\'image de la ligne ALG');
            reject();
        };
    });
},

drawCarte: function(ctx, img, interstationsData) {
    // Dessiner l'image de fond
    ctx.drawImage(img, 0, 0);

    // Dessiner les interstations
    this.listeInter.forEach((inter) => {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            // Taille proportionnelle au nombre d'excès
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

            // Couleur selon la voie
            ctx.fillStyle = inter.voie === "V2" ?
                'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

            ctx.beginPath();
            ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Texte avec le nombre d'excès
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.total.toString(), inter.x, inter.y);

            // Nom de l'interstation
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
        }
    });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
    for (const inter of this.listeInter) {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
            const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

            if (distance <= radius + tolerance) {
                return { inter, data };
            }
        }
    }
    return null;
}
};
