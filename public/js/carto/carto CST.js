window.cartoCST={
 listeInter:[
  {
    "nom": "-- -- Fin quai BELLEVUE",
    "voie": "V1",
    "x": 363,
    "y": 79
  },
  {
    "nom": "Fin quai BELLEVUE -- Fin quai KADDOUR",
    "voie": "V1",
    "x": 349,
    "y": 153
  },
  {
    "nom": "Fin quai KADDOUR -- Fin quai KAD",
    "voie": "V1",
    "x": 354,
    "y": 209
  },
  {
    "nom": "Fin quai KAD -- Fin quai FSA",
    "voie": "V1",
    "x": 429,
    "y": 210
  },
  {
    "nom": "Fin quai FSA -- Fin quai PALMA",
    "voie": "V1",
    "x": 456,
    "y": 201
  },
  {
    "nom": "Fin quai PALMA -- Fin quai UME",
    "voie": "V1",
    "x": 520,
    "y": 220
  },
  {
    "nom": "Fin quai UME -- Fin quai RUN",
    "voie": "V1",
    "x": 532,
    "y": 320
  },
  {
    "nom": "Fin quai RUN -- Fin quai KHE",
    "voie": "V1",
    "x": 549,
    "y": 459
  },
  {
    "nom": "Fin quai KHE -- Fin quai ZOU",
    "voie": "V1",
    "x": 562,
    "y": 590
  },
  {
    "nom": "Fin quai ZOU -- Fin quai 1 Aifour",
    "voie": "V1",
    "x": 574,
    "y": 729
  },
  {
    "nom": "Fin quai 1 Aifour -- Fin quai 1 Boubnider",
    "voie": "V1",
    "x": 403,
    "y": 820
  },
  {
    "nom": "Fin quai 1 Boubnider -- Fin quai 1 19 mai 1956",
    "voie": "V1",
    "x": 346,
    "y": 1068
  },
  {
    "nom": "Fin quai 1 19 mai 1956 -- Fin quai 1 08 mail 1945",
    "voie": "V1",
    "x": 307,
    "y": 1206
  },
  {
    "nom": "Fin quai 1 08 mail 1945 -- Fin quai Kadri Brahim",
    "voie": "V1",
    "x": 390,
    "y": 1277
  },
  {
    "nom": "Fin quai Kadri Brahim -- Fin quai Chouhada",
    "voie": "V1",
    "x": 373,
    "y": 1307
  },
  {
    "nom": "Fin quai Chouhada -- Fin quai Al Istiklal",
    "voie": "V1",
    "x": 314,
    "y": 1303
  },
  {
    "nom": "Fin quai Al Istiklal -- Fin quai Ali Mendjli",
    "voie": "V1",
    "x": 238,
    "y": 1298
  },
  {
    "nom": "Fin quai Ali Mendjli -- Fin quai avenue ALN",
    "voie": "V1",
    "x": 173,
    "y": 1342
  },
  {
    "nom": "Fin quai avenue ALN -- Fin quai ennasr",
    "voie": "V1",
    "x": 148,
    "y": 1403
  },
  {
    "nom": "Fin quai ennasr -- --",
    "voie": "V1",
    "x": 148,
    "y": 1429
  },
  {
    "nom": "-- -- Fin quai ennasr",
    "voie": "V2",
    "x": 174,
    "y": 1443
  },
  {
    "nom": "Fin quai ennasr -- Fin quai avenue ALN",
    "voie": "V2",
    "x": 186,
    "y": 1400
  },
  {
    "nom": "Fin quai avenue ALN -- Fin quai Ali Mendjli",
    "voie": "V2",
    "x": 204,
    "y": 1360
  },
  {
    "nom": "Fin quai Ali Mendjli -- Fin quai Al Istiklal",
    "voie": "V2",
    "x": 246,
    "y": 1335
  },
  {
    "nom": "Fin quai Al Istiklal -- Fin quai Chouhada",
    "voie": "V2",
    "x": 313,
    "y": 1337
  },
  {
    "nom": "Fin quai Chouhada -- Fin quai Kadri Brahim",
    "voie": "V2",
    "x": 397,
    "y": 1334
  },
  {
    "nom": "Fin quai Kadri Brahim -- Fin quai 8 Mai 1945",
    "voie": "V2",
    "x": 440,
    "y": 1276
  },
  {
    "nom": "Fin quai 8 Mai 1945 -- Fin quai 19 Mai 1956",
    "voie": "V2",
    "x": 373,
    "y": 1181
  },
  {
    "nom": "Fin quai 19 Mai 1956 -- Fin quai Boubnider",
    "voie": "V2",
    "x": 402,
    "y": 1087
  },
  {
    "nom": "Fin quai Boubnider -- Fin quai Aifour",
    "voie": "V2",
    "x": 468,
    "y": 916
  },
  {
    "nom": "Fin quai Aifour -- Fin quai ZOU",
    "voie": "V2",
    "x": 623,
    "y": 753
  },
  {
    "nom": "Fin quai ZOU -- Fin quai KHE",
    "voie": "V2",
    "x": 626,
    "y": 624
  },
  {
    "nom": "Fin quai KHE -- Fin quai RUN",
    "voie": "V2",
    "x": 627,
    "y": 478
  },
  {
    "nom": "Fin quai RUN -- Fin quai UME",
    "voie": "V2",
    "x": 593,
    "y": 337
  },
  {
    "nom": "Fin quai UME -- Fin quai PALMA/TIV25",
    "voie": "V2",
    "x": 552,
    "y": 201
  },
  {
    "nom": "Fin quai PALMA/TIV25 -- Fin quai FSA",
    "voie": "V2",
    "x": 474,
    "y": 182
  },
  {
    "nom": "Fin quai FSA -- Fin quai KAD",
    "voie": "V2",
    "x": 417,
    "y": 157
  },
  {
    "nom": "Fin quai KAD -- Fin quai KADDOUR",
    "voie": "V2",
    "x": 385,
    "y": 199
  },
  {
    "nom": "Fin quai KADDOUR -- Fin quai BELLEVUE",
    "voie": "V2",
    "x": 386,
    "y": 153
  },
  {
    "nom": "Fin quai BELLEVUE -- Fin quai BAM 2",
    "voie": "V2",
    "x": 409,
    "y": 89
  },
  {
    "nom": "Fin quai BAM 2 -- --",
    "voie": "V2",
    "x": 441,
    "y": 31
  }

],

initCarto: function(canvas, interstationsData) {
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.src = '/images/lignes/ligne CST.png';

  return new Promise((resolve, reject) => {
      img.onload = () => {
          this.drawCarte(ctx, img, interstationsData);
          resolve();
      };

      img.onerror = () => {
          console.error('Erreur de chargement de l\'image de la ligne CST');
          reject();
      };
  });
},

drawCarte: function(ctx, img, interstationsData) {
  // Dessiner l'image de fond
  ctx.drawImage(img, 0, 0);

  // Dessiner les interstations
  this.listeInter.forEach((inter) => {
      const data = interstationsData.find(d => d.nom === inter.nom);
      if (data && data.total > 0) {
          // Taille proportionnelle au nombre d'excès
          const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

          // Couleur selon la voie
          ctx.fillStyle = inter.voie === "V2" ?
              'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

          ctx.beginPath();
          ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
          ctx.fill();

          // Texte avec le nombre d'excès
          ctx.fillStyle = 'white';
          ctx.font = 'bold 12px Arial';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(data.total.toString(), inter.x, inter.y);

          // Nom de l'interstation
          ctx.fillStyle = '#333';
          ctx.font = '10px Arial';
          ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
      }
  });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
  for (const inter of this.listeInter) {
      const data = interstationsData.find(d => d.nom === inter.nom);
      if (data && data.total > 0) {
          const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
          const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

          if (distance <= radius + tolerance) {
              return { inter, data };
          }
      }
  }
  return null;
}
};
