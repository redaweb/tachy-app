window.cartoORN={
listeInter:[
  {
    "nom": "-- -- Station GRS",
    "voie": "V1",
    "x": 0,
    "y": 0
  },
  {
    "nom": "Station GRS -- Station JAR",
    "voie": "V1",
    "x": 180,
    "y": 800
  },
  {
    "nom": "Station JAR -- Station HOR",
    "voie": "V1",
    "x": 250,
    "y": 730
  },
  {
    "nom": "Station HOR -- Station EAB",
    "voie": "V1",
    "x": 330,
    "y": 710
  },
  {
    "nom": "Station EAB -- Station ADA",
    "voie": "V1",
    "x": 410,
    "y": 710
  },
  {
    "nom": "Station ADA -- Station MAT",
    "voie": "V1",
    "x": 470,
    "y": 710
  },
  {
    "nom": "Station MAT -- Station RAD",
    "voie": "V1",
    "x": 540,
    "y": 670
  },
  {
    "nom": "Station RAD -- Station CIT",
    "voie": "V1",
    "x": 480,
    "y": 610
  },
  {
    "nom": "Station CIT -- Station DIA",
    "voie": "V1",
    "x": 440,
    "y": 540
  },
  {
    "nom": "Station DIA -- Station WIA",
    "voie": "V1",
    "x": 440,
    "y": 440
  },
  {
    "nom": "Station WIA -- Station SID",
    "voie": "V1",
    "x": 460,
    "y": 380
  },
  {
    "nom": "Station SID -- Station AAD",
    "voie": "V1",
    "x": 450,
    "y": 280
  },
  {
    "nom": "Station AAD -- Station GRN",
    "voie": "V1",
    "x": 440,
    "y": 230
  },
  {
    "nom": "Station GRN -- Station NGF",
    "voie": "V1",
    "x": 440,
    "y": 150
  },
  {
    "nom": "Station NGF -- Station CAM",
    "voie": "V1",
    "x": 330,
    "y": 130
  },
  {
    "nom": "Station CAM -- Station NIA",
    "voie": "V1",
    "x": 270,
    "y": 260
  },
  {
    "nom": "Station NIA -- Station FAC",
    "voie": "V1",
    "x": 300,
    "y": 330
  },
  {
    "nom": "Station FAC -- Station ENV",
    "voie": "V1",
    "x": 400,
    "y": 330
  },
  {
    "nom": "Station ENV -- Station HAM",
    "voie": "V1",
    "x": 500,
    "y": 310
  },
  {
    "nom": "Station HAM -- Station ADN",
    "voie": "V1",
    "x": 550,
    "y": 310
  },
  {
    "nom": "Station ADN -- Station GRE",
    "voie": "V1",
    "x": 600,
    "y": 320
  },
  {
    "nom": "Station GRE -- Station CAS",
    "voie": "V1",
    "x": 570,
    "y": 390
  },
  {
    "nom": "Station CAS -- --",
    "voie": "V1",
    "x": 0,
    "y": 0
  },
  {
    "nom": "-- -- Station CAS",
    "voie": "V2",
    "x": 0,
    "y": 0
  },
  {
    "nom": "Station CAS -- Station GRE",
    "voie": "V2",
    "x": 600,
    "y": 390
  },
  {
    "nom": "Station GRE -- Station ADN",
    "voie": "V2",
    "x": 630,
    "y": 320
  },
  {
    "nom": "Station ADN -- Station HAM",
    "voie": "V2",
    "x": 560,
    "y": 280
  },
  {
    "nom": "Station HAM -- Station ENV",
    "voie": "V2",
    "x": 500,
    "y": 280
  },
  {
    "nom": "Station ENV -- Station FAC",
    "voie": "V2",
    "x": 400,
    "y": 300
  },
  {
    "nom": "Station FAC -- Station NIA",
    "voie": "V2",
    "x": 300,
    "y": 300
  },
  {
    "nom": "Station NIA -- Station CAM",
    "voie": "V2",
    "x": 300,
    "y": 260
  },
  {
    "nom": "Station CAM -- Station NGF",
    "voie": "V2",
    "x": 330,
    "y": 170
  },
  {
    "nom": "Station NGF -- Station GRN",
    "voie": "V2",
    "x": 410,
    "y": 150
  },
  {
    "nom": "Station GRN -- Station AAD",
    "voie": "V2",
    "x": 410,
    "y": 230
  },
  {
    "nom": "Station AAD -- Station SID",
    "voie": "V2",
    "x": 440,
    "y": 290
  },
  {
    "nom": "Station SID -- Station WIA",
    "voie": "V2",
    "x": 445,
    "y": 360
  },
  {
    "nom": "Station WIA -- Station DAI",
    "voie": "V2",
    "x": 420,
    "y": 440
  },
  {
    "nom": "Station DAI -- Station CIT",
    "voie": "V2",
    "x": 420,
    "y": 520
  },
  {
    "nom": "Station CIT -- Station RAD",
    "voie": "V2",
    "x": 460,
    "y": 620
  },
  {
    "nom": "Station RAD -- Station MAT",
    "voie": "V2",
    "x": 500,
    "y": 660
  },
  {
    "nom": "Station MAT -- Station ADA",
    "voie": "V2",
    "x": 470,
    "y": 690
  },
  {
    "nom": "Station ADA -- Station EAB",
    "voie": "V2",
    "x": 410,
    "y": 690
  },
  {
    "nom": "Station EAB -- Station HOR",
    "voie": "V2",
    "x": 330,
    "y": 690
  },
  {
    "nom": "Station HOR -- Station JAR",
    "voie": "V2",
    "x": 240,
    "y": 700
  },
  {
    "nom": "Station JAR -- Station GRS",
    "voie": "V2",
    "x": 180,
    "y": 760
  },
  {
    "nom": "Station GRS -- --",
    "voie": "V2",
    "x": 0,
    "y": 0
  }
],

initCarto: function(canvas, interstationsData) {
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = '/images/lignes/ligne-ORN.png';

    return new Promise((resolve, reject) => {
        img.onload = () => {
            this.drawCarte(ctx, img, interstationsData);
            resolve();
        };

        img.onerror = () => {
            console.error('Erreur de chargement de l\'image de la ligne ORN');
            reject();
        };
    });
},

drawCarte: function(ctx, img, interstationsData) {
    // Dessiner l'image de fond
    ctx.drawImage(img, 0, 0);

    // Dessiner les interstations
    this.listeInter.forEach((inter) => {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            // Taille proportionnelle au nombre d'excès
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

            // Couleur selon la voie
            ctx.fillStyle = inter.voie === "V2" ?
                'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

            ctx.beginPath();
            ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Texte avec le nombre d'excès
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.total.toString(), inter.x, inter.y);

            // Nom de l'interstation
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
        }
    });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
    for (const inter of this.listeInter) {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
            const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

            if (distance <= radius + tolerance) {
                return { inter, data };
            }
        }
    }
    return null;
}
};
