window.cartoMGM={
listeInter:[

  {
    "nom": "-- -- Fin STV KHE",
    "voie": "V2",
    "x": 611,
    "y": 8
  },
  {
    "nom": "Fin STV KHE -- Fin STV CSP",
    "voie": "V2",
    "x": 600,
    "y": 31
  },
  {
    "nom": "Fin STV CSP -- Fin STV CUN",
    "voie": "V2",
    "x": 576,
    "y": 52
  },
  {
    "nom": "Fin STV CUN -- Fin STV FAC",
    "voie": "V2",
    "x": 556,
    "y": 101
  },
  {
    "nom": "Fin STV FAC -- Fin STV HES",
    "voie": "V2",
    "x": 564,
    "y": 147
  },
  {
    "nom": "Fin STV HES -- Fin STV EPC",
    "voie": "V2",
    "x": 551,
    "y": 171
  },
  {
    "nom": "Fin STV EPC -- FIN STV CU2",
    "voie": "V2",
    "x": 534,
    "y": 230
  },
  {
    "nom": "FIN STV CU2 -- FIN STV CU1",
    "voie": "V2",
    "x": 515,
    "y": 251
  },
  {
    "nom": "FIN STV CU1 -- FIN STV TIG",
    "voie": "V2",
    "x": 503,
    "y": 288
  },
  {
    "nom": "FIN STV TIG -- FIN STV HOP",
    "voie": "V2",
    "x": 482,
    "y": 318
  },
  {
    "nom": "FIN STV HOP -- FIN STV ALN",
    "voie": "V2",
    "x": 490,
    "y": 342
  },
  {
    "nom": "FIN STV ALN -- FIN STV ARS",
    "voie": "V2",
    "x": 496,
    "y": 389
  },
  {
    "nom": "FIN STV ARS -- FIN STV GRS 1",
    "voie": "V2",
    "x": 484,
    "y": 420
  },
  {
    "nom": "FIN STV GRS 1 -- Fin STV KHE",
    "voie": "V2",
    "x": 438,
    "y": 468
  },
  {
    "nom": "Fin STV KHE -- FIN STV HAM",
    "voie": "V2",
    "x": 411,
    "y": 523
  },
  {
    "nom": "FIN STV HAM -- FIN STV GOU",
    "voie": "V2",
    "x": 389,
    "y": 542
  },
  {
    "nom": "FIN STV GOU -- FIN STV CBD",
    "voie": "V2",
    "x": 354,
    "y": 544
  },
  {
    "nom": "FIN STV CBD -- FIN STV RDP",
    "voie": "V2",
    "x": 337,
    "y": 530
  },
  {
    "nom": "FIN STV RDP -- FIN STV CIT",
    "voie": "V2",
    "x": 309,
    "y": 502
  },
  {
    "nom": "FIN STV CIT -- FIN STV SAL",
    "voie": "V2",
    "x": 281,
    "y": 540
  },
  {
    "nom": "FIN STV SAL -- --",
    "voie": "V2",
    "x": 240,
    "y": 533
  },
  {
    "nom": "-- -- Fin stv NOG",
    "voie": "V2",
    "x": 641,
    "y": 578
  },
  {
    "nom": "Fin stv NOG -- Fin STV CIJ",
    "voie": "V2",
    "x": 585,
    "y": 543
  },
  {
    "nom": "Fin STV CIJ -- Fin STV ABD",
    "voie": "V2",
    "x": 545,
    "y": 510
  },
  {
    "nom": "Fin STV ABD -- Fin stv SNTF2 (taquet d'arret)",
    "voie": "V2",
    "x": 506,
    "y": 476
  },
  {
    "nom": "Début STV SNTF2 -- Fin STV ABD",
    "voie": "V1",
    "x": 471,
    "y": 483
  },
  {
    "nom": "Fin STV ABD -- Fin STV CIJ",
    "voie": "V1",
    "x": 504,
    "y": 518
  },
  {
    "nom": "Fin STV CIJ -- Fin STV NGR",
    "voie": "V1",
    "x": 549,
    "y": 554
  },
  {
    "nom": "Fin STV NGR -- --",
    "voie": "V1",
    "x": 575,
    "y": 604
  },
  {
    "nom": "-- -- Fin STV SAL",
    "voie": "V1",
    "x": 249,
    "y": 564
  },
  {
    "nom": "Fin STV SAL -- Fin STV CIT",
    "voie": "V1",
    "x": 281,
    "y": 561
  },
  {
    "nom": "Fin STV CIT -- Fin STV RDP",
    "voie": "V1",
    "x": 308,
    "y": 525
  },
  {
    "nom": "Fin STV RDP -- Fin STV CBD",
    "voie": "V1",
    "x": 318,
    "y": 538
  },
  {
    "nom": "Fin STV CBD -- Fin STV GOU",
    "voie": "V1",
    "x": 343,
    "y": 563
  },
  {
    "nom": "Fin STV GOU -- Fin STV HAM",
    "voie": "V1",
    "x": 391,
    "y": 560
  },
  {
    "nom": "Fin STV HAM -- Fin STV KHE",
    "voie": "V1",
    "x": 425,
    "y": 536
  },
  {
    "nom": "Fin STV KHE -- Fin STV GRS",
    "voie": "V1",
    "x": 447,
    "y": 493
  },
  {
    "nom": "Fin STV GRS -- Fin STV ARS",
    "voie": "V1",
    "x": 502,
    "y": 435
  },
  {
    "nom": "Fin STV ARS -- Fin STV ALN+SLT",
    "voie": "V1",
    "x": 522,
    "y": 395
  },
  {
    "nom": "Fin STV ALN+SLT -- Fin STV HOP",
    "voie": "V1",
    "x": 508,
    "y": 347
  },
  {
    "nom": "Fin STV HOP -- Fin STV TIG",
    "voie": "V1",
    "x": 500,
    "y": 319
  },
  {
    "nom": "Fin STV TIG -- Fin STV CU1",
    "voie": "V1",
    "x": 521,
    "y": 300
  },
  {
    "nom": "Fin STV CU1 -- Fin STV CU2",
    "voie": "V1",
    "x": 532,
    "y": 269
  },
  {
    "nom": "Fin STV CU2 -- Fin STV EPC",
    "voie": "V1",
    "x": 554,
    "y": 236
  },
  {
    "nom": "Fin STV EPC -- Fin STV HES",
    "voie": "V1",
    "x": 560,
    "y": 192
  },
  {
    "nom": "Fin STV HES -- Fin STV FAC",
    "voie": "V1",
    "x": 587,
    "y": 159
  },
  {
    "nom": "Fin STV FAC -- Fin STV CUN",
    "voie": "V1",
    "x": 585,
    "y": 106
  },
  {
    "nom": "Fin STV CUN -- Fin STV CSP",
    "voie": "V1",
    "x": 591,
    "y": 71
  },
  {
    "nom": "Fin STV CSP -- Fin STV UKH",
    "voie": "V1",
    "x": 620,
    "y": 48
  },
  {
    "nom": "Fin STV UKH -- --",
    "voie": "V1",
    "x": 664,
    "y": 21
  }

],
initCarto: function(canvas, interstationsData) {
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = '/images/lignes/ligne MGM.png';

    return new Promise((resolve, reject) => {
        img.onload = () => {
            this.drawCarte(ctx, img, interstationsData);
            resolve();
        };

        img.onerror = () => {
            console.error('Erreur de chargement de l\'image de la ligne MGM');
            reject();
        };
    });
},

drawCarte: function(ctx, img, interstationsData) {
    // Dessiner l'image de fond
    ctx.drawImage(img, 0, 0);

    // Dessiner les interstations
    this.listeInter.forEach((inter) => {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            // Taille proportionnelle au nombre d'excès
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

            // Couleur selon la voie
            ctx.fillStyle = inter.voie === "V2" ?
                'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

            ctx.beginPath();
            ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Texte avec le nombre d'excès
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.total.toString(), inter.x, inter.y);

            // Nom de l'interstation
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
        }
    });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
    for (const inter of this.listeInter) {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
            const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

            if (distance <= radius + tolerance) {
                return { inter, data };
            }
        }
    }
    return null;
}
};
