window.cartoORN={
listeInter:[
    {
        "nom": "Station SMA -- Station HSA",
        "voie": "V2",
        "x": "860",
        "y": "200"
    },
    {
        "nom": "Station HSA -- Station YAS",
        "voie": "V2",
        "x": "864",
        "y": "153"
    },
    {
        "nom": "Station YAS -- Station UOB",
        "voie": "V2",
        "x": "840",
        "y": "110"
    },
    {
        "nom": "Station UOB -- Station UUO",
        "voie": "V2",
        "x": "780",
        "y": "90"
    },
    {
        "nom": "Station UUO -- Station H1N",
        "voie": "V2",
        "x": "720",
        "y": "103"
    },
    {
        "nom": "Station H1N -- Station CUO",
        "voie": "V2",
        "x": "690",
        "y": "105"
    },
    {
        "nom": "Station CUO -- Station CTC",
        "voie": "V2",
        "x": "645",
        "y": "105"
    },
    {
        "nom": "Station CTC -- Station PDJ",
        "voie": "V2",
        "x": "600",
        "y": "105"
    },
    {
        "nom": "Station PDJ -- Station MIB",
        "voie": "V2",
        "x": "545",
        "y": "130"
    },
    {
        "nom": "Station MIB -- Station HMO",
        "voie": "V2",
        "x": "495",
        "y": "130"
    },
    {
        "nom": "Station HMO -- Station MAA",
        "voie": "V2",
        "x": "450",
        "y": "127"
    },
    {
        "nom": "Station MAA -- Station MOP",
        "voie": "V2",
        "x": "415",
        "y": "127"
    },
    {
        "nom": "Station MOP -- Station 1BD",
        "voie": "V2",
        "x": "360",
        "y": "120"
    },
    {
        "nom": "Station 1BD -- Station GSN",
        "voie": "V2",
        "x": "300",
        "y": "110"
    },
    {
        "nom": "Station GSN -- Station EAB",
        "voie": "V2",
        "x": "240",
        "y": "103"
    },
    {
        "nom": "Station EAB -- Station P1N",
        "voie": "V2",
        "x": "210",
        "y": "93"
    },
    {
        "nom": "Station P1N -- Station MOK",
        "voie": "V2",
        "x": "165",
        "y": "127"
    },
    {
        "nom": "Station MOK -- Station THO",
        "voie": "V2",
        "x": "150",
        "y": "160"
    },
    {
        "nom": "Station THO -- Station MED",
        "voie": "V2",
        "x": "150",
        "y": "190"
    },
    {
        "nom": "Station MED -- Station GHA",
        "voie": "V2",
        "x": "150",
        "y": "215"
    },
    {
        "nom": "Station GHA -- Station PDS",
        "voie": "V2",
        "x": "150",
        "y": "245"
    },
    {
        "nom": "Station PDS -- Station SWI",
        "voie": "V2",
        "x": "160",
        "y": "270"
    },
    {
        "nom": "Station SWI -- Station CIU",
        "voie": "V2",
        "x": "170",
        "y": "310"
    },
    {
        "nom": "Station CIU -- Station JOT",
        "voie": "V2",
        "x": "180",
        "y": "345"
    },
    {
        "nom": "Station JOT -- Station LYP",
        "voie": "V2",
        "x": "185",
        "y": "375"
    },
    {
        "nom": "Station LYP -- Station CVE",
        "voie": "V2",
        "x": "198",
        "y": "405"
    },
    {
        "nom": "Station CVE -- Station IGM",
        "voie": "V2",
        "x": "210",
        "y": "440"
    },
    {
        "nom": "Station IGM -- Station MOA",
        "voie": "V2",
        "x": "225",
        "y": "470"
    },
    {
        "nom": "Station MOA -- Station SEC",
        "voie": "V2",
        "x": "240",
        "y": "510"
    },
    {
        "nom": "Station SEC -- Station SET",
        "voie": "V2",
        "x": "265",
        "y": "540"
    },
    {
        "nom": "Station SET -- Station SEU",
        "voie": "V2",
        "x": "295",
        "y": "580"
    },
    {
        "nom": "Station HSA. -- Station SMA.",
        "voie": "V1",
        "x": "820",
        "y": "200"
    },
    {
        "nom": "Station YAS. -- Station HSA.",
        "voie": "V1",
        "x": "824",
        "y": "153"
    },
    {
        "nom": "Station UOB. -- Station YAS.",
        "voie": "V1",
        "x": "810",
        "y": "110"
    },
    {
        "nom": "Station UUO. -- Station UOB.",
        "voie": "V1",
        "x": "780",
        "y": "130"
    },
    {
        "nom": "Station H1N. -- Station UUO.",
        "voie": "V1",
        "x": "720",
        "y": "143"
    },
    {
        "nom": "Station CUO. -- Station H1N.",
        "voie": "V1",
        "x": "690",
        "y": "145"
    },
    {
        "nom": "Station CTC. -- Station CUO.",
        "voie": "V1",
        "x": "645",
        "y": "145"
    },
    {
        "nom": "Station PDJ. -- Station CTC.",
        "voie": "V1",
        "x": "600",
        "y": "145"
    },
    {
        "nom": "Station MIB. -- Station PDJ.",
        "voie": "V1",
        "x": "545",
        "y": "170"
    },
    {
        "nom": "Station HMO. -- Station MIB.",
        "voie": "V1",
        "x": "495",
        "y": "170"
    },
    {
        "nom": "Station MAA. -- Station HMO.",
        "voie": "V1",
        "x": "450",
        "y": "167"
    },
    {
        "nom": "Station MOP. -- Station MAA.",
        "voie": "V1",
        "x": "415",
        "y": "167"
    },
    {
        "nom": "Station 1BD. -- Station MOP.",
        "voie": "V1",
        "x": "360",
        "y": "160"
    },
    {
        "nom": "Station GSN. -- Station 1BD.",
        "voie": "V1",
        "x": "300",
        "y": "150"
    },
    {
        "nom": "Station EAB.-- Station GSN.",
        "voie": "V1",
        "x": "240",
        "y": "143"
    },
    {
        "nom": "Station P1N. -- Station EAB.",
        "voie": "V1",
        "x": "210",
        "y": "133"
    },
    {
        "nom": "Station MOK. -- Station P1N.",
        "voie": "V1",
        "x": "195",
        "y": "127"
    },
    {
        "nom": "Station THO. -- Station MOK.",
        "voie": "V1",
        "x": "190",
        "y": "160"
    },
    {
        "nom": "Station MED. -- Station THO.",
        "voie": "V1",
        "x": "190",
        "y": "190"
    },
    {
        "nom": "Station GHA. -- Station MED.",
        "voie": "V1",
        "x": "190",
        "y": "215"
    },
    {
        "nom": "Station PDS. -- Station GHA.",
        "voie": "V1",
        "x": "190",
        "y": "245"
    },
    {
        "nom": "Station SWI. -- Station PDS.",
        "voie": "V1",
        "x": "200",
        "y": "270"
    },
    {
        "nom": "Station CIU. -- Station SWI.",
        "voie": "V1",
        "x": "210",
        "y": "310"
    },
    {
        "nom": "Station JOT. -- Station CIU.",
        "voie": "V1",
        "x": "220",
        "y": "345"
    },
    {
        "nom": "Station LYP. -- Station JOT.",
        "voie": "V1",
        "x": "225",
        "y": "375"
    },
    {
        "nom": "Station CVE. -- Station LYP.",
        "voie": "V1",
        "x": "238",
        "y": "405"
    },
    {
        "nom": "Station IGM. -- Station CVE.",
        "voie": "V1",
        "x": "250",
        "y": "440"
    },
    {
        "nom": "Station MOA. -- Station IGM.",
        "voie": "V1",
        "x": "265",
        "y": "470"
    },
    {
        "nom": "Station SEC. -- Station MOA.",
        "voie": "V1",
        "x": "280",
        "y": "510"
    },
    {
        "nom": "Station SET. -- Station SEC.",
        "voie": "V1",
        "x": "305",
        "y": "540"
    },
    {
        "nom": "Station SEU. -- Station SET.",
        "voie": "V1",
        "x": "335",
        "y": "580"
    }
],

initCarto: function(canvas, interstationsData) {
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = '/images/lignes/ligne ORN.png';

    return new Promise((resolve, reject) => {
        img.onload = () => {
            this.drawCarte(ctx, img, interstationsData);
            resolve();
        };

        img.onerror = () => {
            console.error('Erreur de chargement de l\'image de la ligne ORN');
            reject();
        };
    });
},

drawCarte: function(ctx, img, interstationsData) {
    // Dessiner l'image de fond
    ctx.drawImage(img, 0, 0);

    // Dessiner les interstations
    this.listeInter.forEach((inter) => {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            // Taille proportionnelle au nombre d'excès
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);

            // Couleur selon la voie
            ctx.fillStyle = inter.voie === "V2" ?
                'rgba(0, 0, 255, 0.7)' : 'rgba(255, 0, 0, 0.7)';

            ctx.beginPath();
            ctx.arc(inter.x, inter.y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Texte avec le nombre d'excès
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(data.total.toString(), inter.x, inter.y);

            // Nom de l'interstation
            ctx.fillStyle = '#333';
            ctx.font = '10px Arial';
            ctx.fillText(inter.nom, inter.x, inter.y + radius + 15);
        }
    });
},

getInterstationAtPosition: function(x, y, interstationsData, tolerance = 15) {
    for (const inter of this.listeInter) {
        const data = interstationsData.find(d => d.nom === inter.nom);
        if (data && data.total > 0) {
            const radius = Math.min(30, 10 + Math.sqrt(data.total) * 3);
            const distance = Math.sqrt(Math.pow(x - inter.x, 2) + Math.pow(y - inter.y, 2));

            if (distance <= radius + tolerance) {
                return { inter, data };
            }
        }
    }
    return null;
}
};
